# Secret Rotation Configuration
# Defines all secrets that can be automatically rotated

# Format:
# secret_name:
#   type: random|jwt-token|api-key|bcrypt-password
#   length: number of characters
#   files: list of .env files where this secret appears
#   auto_rotate: true if should be auto-generated, false if user-managed
#   description: human-readable description
#   depends_on: list of other secrets this depends on (e.g., JWT tokens depend on JWT_SECRET)

secrets:
  # N8N Secrets
  N8N_ENCRYPTION_KEY:
    type: random
    length: 32
    files:
      - .env
    auto_rotate: true
    description: "n8n encryption key for workflow credentials"
    restart_services:
      - n8n

  N8N_USER_MANAGEMENT_JWT_SECRET:
    type: random
    length: 32
    files:
      - .env
    auto_rotate: true
    description: "n8n JWT secret for user management"
    restart_services:
      - n8n
      - nocodb

  # PostgreSQL
  POSTGRES_PASSWORD:
    type: random
    length: 48
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "PostgreSQL superuser password"
    restart_services:
      - supabase-db
      - n8n
      - nocodb
      - backup

  # Supabase JWT Secrets
  JWT_SECRET:
    type: random
    length: 64
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "Supabase JWT signing secret"
    restart_services:
      - supabase-auth
      - supabase-rest
      - supabase-realtime
      - supabase-studio
      - supabase-edge-functions
      - supabase-pooler

  ANON_KEY:
    type: jwt-token
    role: anon
    depends_on: JWT_SECRET
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "Supabase anonymous user JWT token"
    restart_services:
      - supabase-kong
      - supabase-studio

  SERVICE_ROLE_KEY:
    type: jwt-token
    role: service_role
    depends_on: JWT_SECRET
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "Supabase service role JWT token"
    restart_services:
      - supabase-kong
      - supabase-studio

  # Supabase Dashboard
  DASHBOARD_USERNAME:
    type: static
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: false
    description: "Supabase dashboard username (user-defined)"

  DASHBOARD_PASSWORD:
    type: random
    length: 32
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "Supabase dashboard password"
    restart_services:
      - supabase-kong

  # Encryption Keys
  SECRET_KEY_BASE:
    type: random
    length: 64
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "Supabase Realtime secret key base"
    restart_services:
      - supabase-realtime
      - supabase-pooler

  VAULT_ENC_KEY:
    type: random
    length: 32
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "Vault encryption key (min 32 chars)"
    restart_services:
      - supabase-pooler

  PG_META_CRYPTO_KEY:
    type: random
    length: 48
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "PostgreSQL metadata encryption key"
    restart_services:
      - supabase-meta
      - supabase-studio

  # Logflare Analytics
  LOGFLARE_LOGGER_BACKEND_API_KEY:
    type: random
    length: 48
    files:
      - .env
    auto_rotate: true
    description: "Logflare logger backend API key"
    restart_services:
      - supabase-analytics

  LOGFLARE_API_KEY:
    type: random
    length: 48
    files:
      - .env
    auto_rotate: true
    description: "Logflare API key"
    restart_services:
      - supabase-analytics

  LOGFLARE_PUBLIC_ACCESS_TOKEN:
    type: random
    length: 48
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "Logflare public access token"
    restart_services:
      - supabase-analytics
      - supabase-studio
      - supabase-vector

  LOGFLARE_PRIVATE_ACCESS_TOKEN:
    type: random
    length: 48
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: true
    description: "Logflare private access token"
    restart_services:
      - supabase-analytics
      - supabase-studio

  # External API Keys (user-managed, not auto-rotated)
  NGC_API_KEY:
    type: static
    files:
      - .env
    auto_rotate: false
    description: "NVIDIA NGC API key (user-managed)"

  OPENAI_API_KEY:
    type: static
    files:
      - .env
      - supabase/docker/.env
    auto_rotate: false
    description: "OpenAI API key (user-managed)"

  CRAWL4AI_API_KEY:
    type: random
    length: 48
    files:
      - .env
    auto_rotate: true
    description: "Crawl4AI internal API key"
    restart_services:
      - crawl4ai

# Service dependency graph for orchestrated restarts
# Format: service_name: [list of services it depends on]
# Restart order: dependencies first, then dependent services
service_dependencies:
  supabase-db: []
  supabase-vector: []
  supabase-analytics: [supabase-db, supabase-vector]
  supabase-auth: [supabase-db, supabase-analytics]
  supabase-rest: [supabase-db, supabase-analytics]
  supabase-realtime: [supabase-db, supabase-analytics]
  supabase-storage: [supabase-db, supabase-rest]
  supabase-meta: [supabase-db, supabase-analytics]
  supabase-edge-functions: [supabase-analytics]
  supabase-pooler: [supabase-db, supabase-analytics]
  supabase-kong: [supabase-analytics]
  supabase-studio: [supabase-analytics, supabase-meta]
  n8n: [supabase-db]
  nocodb: [supabase-db, n8n]
  backup: [supabase-db]
  crawl4ai: []

# Backup settings
backup:
  directory: backups/secrets
  retention_days: 90
  filename_format: "secrets-backup-%Y%m%d-%H%M%S"
